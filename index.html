<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>Happy Birthday Shree! üéâ‚ú®</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <link rel="manifest" href="data:application/manifest+json,{
      'name': 'Happy Birthday Shree! üéâ',
      'short_name': 'ShreeBday',
      'icons': [{
        'src': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9Ijk2IiBjeT0iOTYiIHI9Ijk2IiBmaWxsPSIjZmY2YjZiIi8+CjxjaXJjbGUgY3g9Ijk2IiBjeT0iOTYiIHI9IjgwIiBmaWxsPSIjZmZjZmVmIi8+Cjx0ZXh0IHg9Ijk2IiB5PSIxMDIiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI2MCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IiNmZjZiNmIiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5DPC90ZXh0Pgo8L3N2Zz4K',
        'sizes': '192x192',
        'type': 'image/png'
      }],
      'theme_color': '#ff6b6b',
      'background_color': '#ff9a9e',
      'display': 'standalone'
    }">
    <meta name="theme-color" content="#ff6b6b">
    <style>
        :root{--p:#ff6b6b;--s:#fecfef;--bg:#ff9a9e;--g:#ffd700;--sh:rgba(0,0,0,.2);--lock:#ff4444}
        *{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Arial,sans-serif}
        body{background:linear-gradient(135deg,var(--bg)0%,var(--s)50%,var(--s)100%);background-size:400% 400%;min-height:100vh;overflow-x:hidden;animation:bg 15s ease infinite;position:relative;-webkit-font-smoothing:antialiased;-webkit-tap-highlight-color:transparent}
        @keyframes bg{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
        
        .music-toggle{position:fixed;top:20px;right:20px;z-index:9999;width:60px;height:60px;border-radius:50%;background:rgba(255,255,255,.9);border:none;font-size:1.5rem;cursor:pointer;backdrop-filter:blur(20px);box-shadow:0 8px 32px var(--sh);transition:all .3s;touch-action:manipulation;-webkit-tap-highlight-color:transparent}
        .music-toggle:hover{transform:scale(1.1);background:white}
        .music-toggle.playing{background:linear-gradient(45deg,var(--g),#ffed4a);animation:pulse 1.5s infinite}
        .music-toggle.music-hover{background:linear-gradient(45deg, var(--g), #ffed4a) !important;}
        .music-toggle:active{transform:scale(0.95)}
        @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}

        .locked-overlay{position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,var(--lock),#ff6666);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1000;border-radius:25px;backdrop-filter:blur(10px);animation:pulseLock 2s infinite;text-align:center;color:white}
        .lock-icon{font-size:clamp(4rem,15vw,8rem);margin-bottom:20px;animation:bounce 1.5s infinite}
        .lock-message{font-size:clamp(1.3rem,5vw,2rem);font-weight:900;text-shadow:0 4px 15px rgba(0,0,0,.5);margin-bottom:30px}
        @keyframes pulseLock{0%,100%{transform:scale(1);box-shadow:0 0 30px rgba(255,68,68,.8)}50%{transform:scale(1.02);box-shadow:0 0 50px rgba(255,68,68,1)}}
        section.locked{pointer-events:none}
        section.locked::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);z-index:999}
        
        .hearts{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1;overflow:hidden}
        .heart{position:absolute;color:var(--p);font-size:20px;animation:heartFloat 6s linear infinite;opacity:0;will-change:transform}
        @keyframes heartFloat{0%{transform:translateY(100vh) rotate(0deg);opacity:1}100%{transform:translateY(-100px) rotate(360deg);opacity:0}}
        
        .sparkle{position:fixed;width:4px;height:4px;background:var(--g);border-radius:50%;pointer-events:none;z-index:2;animation:sparkle 3s linear infinite;will-change:transform}
        @keyframes sparkle{0%{transform:translateY(100vh) scale(0);opacity:1}50%{opacity:1}100%{transform:translateY(-20px) scale(1);opacity:0}}
        
        .achievement-badge{position:fixed;top:20px;left:20px;z-index:9998;background:linear-gradient(45deg,var(--g),#ffed4a);padding:15px 25px;border-radius:50px;box-shadow:0 10px 40px rgba(255,215,0,.6);color:#333;font-weight:900;font-size:1.1rem;transform:scale(0);animation:achievementPop 0.6s cubic-bezier(.68,-0.55,.265,1.55) forwards;backdrop-filter:blur(20px)}
        @keyframes achievementPop{0%{transform:scale(0) rotate(-180deg)}50%{transform:scale(1.2) rotate(20deg)}100%{transform:scale(1) rotate(0deg)}}
        
        .c{max-width:1400px;margin:0 auto 160px auto;padding:20px;position:relative;z-index:10;min-height:calc(100vh - 220px)}
        
        nav{position:fixed;top:env(safe-area-inset-top,20px);left:50%;transform:translateX(-50%);background:rgba(255,255,255,.3);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);padding:12px 25px;border-radius:50px;box-shadow:0 8px 32px var(--sh);z-index:100;animation:sd 1s ease-out}
        @keyframes sd{from{opacity:0;transform:translateX(-50%) translateY(-100%)}}
        nav button{background:none;border:none;color:#fff;font-size:clamp(16px,4vw,18px);margin:0 10px;cursor:pointer;padding:12px 20px;border-radius:25px;transition:all .3s;font-weight:700;position:relative;overflow:hidden;min-height:48px;min-width:70px;-webkit-appearance:none;-webkit-tap-highlight-color:transparent}
        nav button:hover{background:rgba(255,255,255,.4);transform:scale(1.05)}
        nav button.active{background:rgba(255,255,255,.6);box-shadow:0 0 20px rgba(255,255,255,.6)}
        nav button.locked{opacity:.5;cursor:not-allowed;transform:none!important}
        nav button.locked:hover{background:none;transform:none}
        
        section{display:none;min-height:100vh;padding-top:140px;padding-bottom:120px;opacity:0;transform:translateY(50px);transition:all .8s cubic-bezier(.25,.46,.45,.94);scroll-margin-top:140px}
        section.active{display:block;opacity:1;transform:translateY(0);scroll-snap-align:start}
        
        #gallery { padding-bottom: 220px; }
        #wishes { padding-bottom: 160px; }
        #games { padding-bottom: 180px; }
        
        .h{text-align:center;color:#fff;text-shadow:0 4px 12px var(--sh)}
        .h h1{font-size:clamp(2.2rem,9vw,5.5rem);margin-bottom:20px;background:linear-gradient(45deg,#fff,var(--g),#fff);background-size:300% 300%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:bounce 2s infinite,gradient 4s ease infinite;line-height:1.1}
        @keyframes bounce{0%,20%,50%,80%,100%{transform:translateY(0)}40%{transform:translateY(-30px)}60%{transform:translateY(-15px)}}
        @keyframes gradient{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
        
        .cd{display:flex;justify-content:center;gap:12px;font-size:clamp(1.1rem,4.5vw,2.2rem);margin:40px auto;flex-wrap:wrap;max-width:600px}
        .cd>div{background:linear-gradient(145deg,rgba(255,255,255,.4),rgba(255,255,255,.2));padding:20px 15px;border-radius:25px;min-width:85px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,.2);backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);animation:pulse 2s infinite;flex:1;max-width:120px}
        .cd span{font-size:clamp(1.6rem,7.5vw,3.2rem);display:block;font-weight:900;text-shadow:0 2px 10px var(--sh);color:#fff;line-height:1}
        
        .m{font-size:clamp(1.2rem,4.5vw,1.9rem);margin:50px auto;max-width:900px;line-height:1.6;animation:fadeIn 2s ease;text-shadow:0 2px 10px var(--sh)}
        @keyframes fadeIn{from{opacity:0;transform:translateY(30px)}}
        
        .cake{position:absolute;top:20%;right:-10%;width:200px;height:180px;animation:float 6s ease-in-out infinite;z-index:5;opacity:.8}
        .cake::before{content:'üéÇ';font-size:8rem;position:absolute}
        @keyframes float{0%,100%{transform:translateY(0px)}50%{transform:translateY(-20px)}}
        
        .cb{font-size:clamp(1.2rem,4vw,1.8rem);padding:22px 60px;border:none;border-radius:60px;background:linear-gradient(45deg,var(--p),#ff8e8e);color:#fff;cursor:pointer;transition:all .4s;font-weight:900;box-shadow:0 12px 35px rgba(255,107,107,.5);margin:30px auto;display:block;min-height:60px;min-width:280px;-webkit-appearance:none;-webkit-tap-highlight-color:transparent}
        .cb:hover{transform:translateY(-8px) scale(1.05);box-shadow:0 20px 50px rgba(255,107,107,.6)}
        .cb:active{transform:translateY(-4px) scale(1.02)}
        .cb.small{padding:15px 30px;font-size:clamp(1rem,3vw,1.2rem);min-height:50px;min-width:auto;margin:8px}
        
        .g{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:20px;padding:30px 0}
        .g img{width:100%;height:260px;object-fit:cover;border-radius:25px;box-shadow:0 15px 40px var(--sh);transition:all .6s;cursor:pointer;background:linear-gradient(45deg,var(--p),var(--s));touch-action:manipulation}
        .g img:hover{transform:scale(1.08) translateY(-15px);box-shadow:0 25px 60px rgba(0,0,0,.4)}
        .g img.error{background:linear-gradient(45deg,var(--p),var(--g));}
        .g img.error::after{content:"Image Missing üíñ";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-weight:900;font-size:1.3rem;text-align:center;padding:20px;background:rgba(0,0,0,.7);border-radius:15px;display:block}
        
        .w{max-width:900px;margin:0 auto;text-align:center}
        .w>div{margin:25px 0;padding:30px;background:linear-gradient(145deg,rgba(255,255,255,.25),rgba(255,255,255,.15));border-radius:25px;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);font-size:clamp(1.2rem,3vw,1.5rem);animation:slideUp 1s ease;box-shadow:0 15px 40px var(--sh)}
        @keyframes slideUp{from{opacity:0;transform:translateY(40px)}}
        
        footer.f{padding:60px 20px 40px;text-align:center;color:#fff;opacity:.95;font-size:clamp(1.1rem,2.5vw,1.3rem);background:linear-gradient(145deg,rgba(255,255,255,.1),rgba(255,255,255,.05));backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-radius:25px;margin:40px auto;border:1px solid rgba(255,255,255,.2);width:90%;max-width:600px}
        
        #si{text-align:center;margin:70px 0;padding:50px;background:linear-gradient(145deg,rgba(255,255,255,.15),rgba(255,255,255,.1));border-radius:40px;backdrop-filter:blur(25px);-webkit-backdrop-filter:blur(25px);box-shadow:0 20px 60px var(--sh)}
        #si input{padding:20px 30px;font-size:clamp(18px,4vw,20px);border-radius:35px;border:2px solid rgba(255,255,255,.4);width:min(90vw,400px);background:rgba(255,255,255,.98);box-shadow:0 10px 35px var(--sh);transition:all .3s;margin-bottom:20px}
        #si input:focus{outline:none;border-color:var(--g);box-shadow:0 0 0 4px rgba(255,215,0,.3)}
        #si button{padding:20px 45px;font-size:clamp(18px,4vw,20px);background:linear-gradient(45deg,var(--g),#ffed4a);color:#333;border:none;border-radius:35px;cursor:pointer;transition:all .4s;font-weight:900;box-shadow:0 10px 35px rgba(255,215,0,.5);min-height:60px;-webkit-appearance:none;-webkit-tap-highlight-color:transparent}
        #si button:hover{transform:translateY(-5px);box-shadow:0 18px 50px rgba(255,215,0,.7)}
        
        .sg{margin-top:50px;padding-bottom:100px}
        .sg h3{color:var(--g);text-align:center;margin-bottom:40px;font-size:clamp(2rem,6vw,2.8rem);animation:glow 2s infinite}
        @keyframes glow{0%,100%{text-shadow:0 0 20px var(--g)}50%{text-shadow:0 0 40px var(--g)}}
        
        .st{text-align:center;color:#fff;font-size:clamp(2rem,8vw,3.5rem);margin-bottom:50px;text-shadow:0 6px 20px var(--sh);background:linear-gradient(45deg,#fff,var(--g));-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:gradient 3s ease infinite}
        
        .md{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.95);display:flex;align-items:center;justify-content:center;z-index:1000;cursor:pointer}
        .md img{max-width:95%;max-height:95%;border-radius:20px;box-shadow:0 30px 80px rgba(0,0,0,.9)}
        
        .games-grid{display:grid;gap:30px;max-width:900px;margin:0 auto;padding:40px 20px;}
        .game-card{background:linear-gradient(145deg,rgba(255,255,255,.25),rgba(255,255,255,.15));padding:30px;border-radius:25px;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);box-shadow:0 15px 40px var(--sh);text-align:center;}
        .game-title{color:var(--g);margin-bottom:25px;font-size:clamp(1.5rem,5vw,2rem);font-weight:900;}
        #memoryGame{width:100%;max-width:400px;height:300px;border-radius:20px;background:#fff;box-shadow:0 15px 40px var(--sh);cursor:pointer;touch-action:manipulation;-webkit-user-select:none;user-select:none;}
        #quizScore, #memoryScore{color:#ffd700;font-size:clamp(1.2rem,3vw,1.4rem);font-weight:900;margin-top:15px;}
        .reset-games{margin:20px auto !important;font-size:1.1rem !important;}
        .share-btn{margin:20px auto !important;font-size:1rem !important;padding:15px 30px !important;}
        
        #achievements{text-align:center;margin:40px 0;padding:30px;background:linear-gradient(145deg,rgba(255,255,255,.15),rgba(255,255,255,.1));border-radius:40px;backdrop-filter:blur(25px);box-shadow:0 20px 60px var(--sh);display:none}
        #achievements h3{color:var(--g);margin-bottom:25px;font-size:clamp(1.8rem,5vw,2.2rem)}
        .badge-list{display:flex;flex-wrap:wrap;gap:15px;justify-content:center;}
        .badge{background:linear-gradient(45deg,var(--g),#ffed4a);padding:12px 20px;border-radius:25px;font-weight:900;color:#333;box-shadow:0 8px 25px rgba(255,215,0,.4);animation:badgeGlow 2s infinite alternate;}
        @keyframes badgeGlow{0%{box-shadow:0 8px 25px rgba(255,215,0,.4)}100%{box-shadow:0 12px 35px rgba(255,215,0,.7)}}
        
        @media screen and (max-width:430px) and (min-width:425px) {
            .h h1{font-size:5rem !important;line-height:1;}
            .cd{gap:8px;justify-content:center;}
            .cd>div{flex:1 0 80px;padding:18px 12px;}
            .cb{width:95vw;padding:25px 40px;}
            .g{grid-template-columns:1fr 1fr;gap:15px;}
            nav button{font-size:16px;padding:10px 16px;margin:0 6px;}
        }
        @media (max-width:768px){nav{padding:10px 20px}nav button{font-size:16px;margin:0 8px;min-height:44px}.cd{gap:8px}.cd>div{padding:15px 12px;min-width:75px}.cake{display:none}.g{grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:15px}}
        @media (max-width:480px){.c{padding:15px 10px}#si button{width:min(90vw,380px);margin:15px auto 0;display:block}#si input{width:85vw}}
    </style>
</head>
<body>
    <button class="music-toggle" id="musicToggle" title="Toggle Birthday Music">üéµ</button>
    
    <div class="hearts" id="hearts"></div>
    <div id="sparkles"></div>
    <div class="cake"></div>

    <nav>
        <button onclick="showSection('home')" class="active" data-section="home">üè† Home</button>
        <button onclick="showSection('gallery')" data-section="gallery" id="galleryBtn">üì∏ Gallery</button>
        <button onclick="showSection('wishes')" data-section="wishes" id="wishesBtn">üíñ Wishes</button>
        <button onclick="showSection('games')" data-section="games" id="gamesBtn">üéÆ Games</button>
    </nav>
    
    <div class="c">
        <section id="home" class="active">
            <div class="h">
                <h1>Happy Birthday, Shree! üéÇ‚ú®</h1>
                <p class="m">Wishing you a year filled with joy, success, and togetherness. You make my world brighter! I Love You! üíï</p>
                <div id="countdown" class="cd"></div>
                <button class="cb" onclick="triggerConfetti()">Let's Celebrate! üéä</button>
                <button class="cb share-btn" onclick="shareBirthday()">üì± Share Birthday Love</button>
            </div>
        </section>
        
        <section id="gallery">
            <h2 class="st">Our Beautiful Memories üì∏</h2>
            <h3 style="color:#fff;text-align:center;margin-bottom:25px;font-size:clamp(1.6rem,4vw,1.9rem);font-weight:900;text-shadow:0 4px 15px var(--sh)">‚ú® (28 Special Moments) ‚ú®</h3>
            <div class="g" id="public-gallery"></div>
            <div id="secret-input">
                <div id="si">
                    <input type="password" id="secret-code" placeholder="üîê Enter Secret Code...">
                    <button onclick="unlockSecret()">Unlock Secret Gallery üîì</button>
                </div>
            </div>
            <div id="secret-gallery" class="sg" style="display:none">
                <h3>üíé Secret Memories (Only for Shree) üíé</h3>
                <div class="g">
                    <img src="images/memory39.jpg" alt="Secret Memory 1" onclick="openModal(this)" loading="lazy">
                    <img src="images/memory40.jpg" alt="Secret Memory 2" onclick="openModal(this)" loading="lazy">
                </div>
            </div>
        </section>
        
        <section id="wishes">
            <h2 class="st">Special Wishes for Shree üíñ</h2>
            <div class="w">
                <div>üåü May all your dreams come true this year!</div>
                <div>ü•≥ Health, happiness, and endless adventures await!</div>
                <div>‚ú® You're amazing, Shree. Keep shining bright!</div>
                <div>üíï Here's to many more beautiful memories together!</div>
            </div>
        </section>
        
        <section id="games">
            <h2 class="st">Birthday Fun Games! üéÆ</h2>
            <div class="games-grid">
                <div class="game-card">
                    <h3 class="game-title">üß† Memory Match</h3>
                    <canvas id="memoryGame"></canvas>
                    <p id="memoryScore">Score: 0</p>
                </div>
                <div class="game-card">
                    <h3 class="game-title">‚ùì Shree Trivia</h3>
                    <div id="quizContainer">
                        <div id="quizGame">
                            <p id="quizQuestion" style="color:#fff;font-size:clamp(1.3rem,4vw,1.5rem);margin-bottom:25px;">Click Reset or navigate away and back to start!</p>
                            <button id="quizBtn1" class="cb small" style="margin:8px;">Option 1</button>
                            <button id="quizBtn2" class="cb small" style="margin:8px;">Option 2</button>
                        </div>
                    </div>
                    <p id="quizScore">Score: 0/8</p>
                </div>
            </div>
            <button class="cb reset-games" id="resetBtn">üîÑ Reset Games</button>
            
            <!-- NEW ACHIEVEMENTS SECTION -->
            <div id="achievements">
                <h3>üèÜ Birthday Achievements Unlocked!</h3>
                <div id="badgeList" class="badge-list"></div>
            </div>
        </section>
    </div>
    
    <footer class="f">Handcrafted with ‚ù§Ô∏è for Shree ‚ú® | From Pikai üíï | PWA Ready üéâ</footer>

    <script>
        const BIRTHDAY_DATE = new Date('2026-01-27T00:00:00+05:30');
        const SECRET_CODE = 'shree2026';
        const partyMelody = [
            {freq: 523.25, dur: 200}, {freq: 659.25, dur: 200}, {freq: 784.00, dur: 400},
            {freq: 659.25, dur: 200}, {freq: 523.25, dur: 200}, {freq: 392.00, dur: 400},
            {freq: 294.00, dur: 300}, {freq: 294.00, dur: 300}, {freq: 330.00, dur: 600}, 
            {freq: 262.00, dur: 600}, {freq: 392.00, dur: 600}, {freq: 349.00, dur: 1200}
        ];
        
        // Game state variables
        let memoryScore = 0;
        let quizCurrent = 0;
        let quizScore = 0;
        let memoryFlipped = [];
        let memoryCanvas, memoryCtx, memoryBoard, memoryGameCards;
        let musicPlayingTime = 0;
        let musicStarted = false;
        let achievements = {
            musicMaster: false,
            memoryChamp: false,
            triviaQueen: false,
            secretUnlocked: false
        };
        
        // üéµ FIXED MUSIC SYSTEM - Browser Autoplay Policy Compliant
        const musicToggle = document.getElementById('musicToggle');
        let currentTimeout = null;
        let oscillators = [];
        let audioContext = null;

        // Resume AudioContext on FIRST user interaction (fixes autoplay policy)
        document.addEventListener('click', function firstClickHandler() {
            if (!musicStarted && !audioContext) {
                musicStarted = true;
                document.removeEventListener('click', firstClickHandler);
            }
        }, { once: true, passive: true });

        musicToggle.addEventListener('click', async function() {
            // Resume AudioContext if suspended (Chrome/Safari autoplay policy)
            if (audioContext && audioContext.state === 'suspended') {
                await audioContext.resume();
            }
            
            if (!musicPlayingTime) {
                // START MUSIC
                musicPlayingTime = Date.now();
                musicToggle.textContent = 'üîá';
                musicToggle.classList.add('playing');
                
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                playPartyMelody();
            } else {
                // STOP MUSIC
                stopAllSounds();
                musicToggle.textContent = 'üéµ';
                musicToggle.classList.remove('playing');
            }
        });

        // Visual feedback for music button hover
        musicToggle.addEventListener('mouseenter', () => {
            if (!musicPlayingTime) {
                musicToggle.classList.add('music-hover');
            }
        });
        musicToggle.addEventListener('mouseleave', () => {
            musicToggle.classList.remove('music-hover');
        });

        function playPartyMelody() {
            if (!musicPlayingTime || !audioContext || audioContext.state === 'suspended') return;
            
            let noteIndex = 0;
            function playNextNote() {
                if (!musicPlayingTime || !audioContext || audioContext.state === 'suspended') return;
                
                const note = partyMelody[noteIndex % partyMelody.length];
                playRichNote(note.freq, note.dur);
                noteIndex++;
                currentTimeout = setTimeout(playNextNote, note.dur + 50);
            }
            playNextNote();
        }

        function playRichNote(freq, duration) {
            if (!audioContext || audioContext.state === 'suspended') return;
            
            const now = audioContext.currentTime;
            
            // Main melody (sine wave - clean tone)
            const osc1 = audioContext.createOscillator();
            osc1.frequency.value = freq;
            osc1.type = 'sine';
            
            const gain1 = audioContext.createGain();
            gain1.gain.setValueAtTime(0, now);
            gain1.gain.linearRampToValueAtTime(0.4, now + 0.02);
            gain1.gain.exponentialRampToValueAtTime(0.01, now + duration/1000);
            
            // Harmony layer (slightly detuned triangle wave)
            const osc2 = audioContext.createOscillator();
            osc2.frequency.value = freq * 1.007;
            osc2.type = 'triangle';
            
            const gain2 = audioContext.createGain();
            gain2.gain.setValueAtTime(0, now);
            gain2.gain.linearRampToValueAtTime(0.18, now + 0.05);
            gain2.gain.exponentialRampToValueAtTime(0.01, now + duration/1000);
            
            // Bass/kick layer (randomized for rhythm)
            if (Math.random() < 0.25) {
                const bassOsc = audioContext.createOscillator();
                bassOsc.frequency.value = freq * 0.5;
                bassOsc.type = 'sine';
                
                const bassGain = audioContext.createGain();
                bassGain.gain.setValueAtTime(0, now);
                bassGain.gain.linearRampToValueAtTime(0.25, now + 0.01);
                bassGain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
                
                bassOsc.connect(bassGain);
                bassGain.connect(audioContext.destination);
                bassOsc.start(now);
                oscillators.push(bassOsc);
            }
            
            osc1.connect(gain1);
            osc2.connect(gain2);
            gain1.connect(audioContext.destination);
            gain2.connect(audioContext.destination);
            
            osc1.start(now);
            osc2.start(now);
            
            oscillators.push(osc1, osc2);
        }

        function stopAllSounds() {
            oscillators.forEach(osc => {
                try {
                    if (osc.stop) osc.stop();
                } catch(e) {}
            });
            oscillators = [];
            if (currentTimeout) {
                clearTimeout(currentTimeout);
                currentTimeout = null;
            }
        }

        // ACHIEVEMENT SYSTEM
        function checkAchievements() {
            const badges = [
                {key: 'musicMaster', name: 'üéµ Music Master (30s+)', check: () => {
                    return musicPlayingTime && (Date.now() - musicPlayingTime) > 30000;
                }},
                {key: 'memoryChamp', name: 'üß† Memory Champion', check: () => memoryScore >= 80},
                {key: 'triviaQueen', name: 'üíñ Soulmate Score (7+)', check: () => quizScore >= 7},
                {key: 'secretUnlocked', name: 'üîì Secret Gallery', check: () => {
                    return document.getElementById('secret-gallery').style.display !== 'none';
                }}
            ];
            
            badges.forEach(badge => {
                if (badge.check() && !achievements[badge.key]) {
                    achievements[badge.key] = true;
                    showAchievement(badge.name);
                    updateAchievementDisplay();
                }
            });
        }

        function showAchievement(name) {
            const badge = document.createElement('div');
            badge.className = 'achievement-badge';
            badge.textContent = `üéâ ${name} Unlocked!`;
            document.body.appendChild(badge);
            setTimeout(() => badge.remove(), 4000);
            triggerConfetti();
        }

        function updateAchievementDisplay() {
            const badgeList = document.getElementById('badgeList');
            const unlockedBadges = Object.entries(achievements)
                .filter(([key, unlocked]) => unlocked)
                .map(([key, unlocked]) => {
                    const badgeNames = {
                        musicMaster: 'üéµ Music Master',
                        memoryChamp: 'üß† Memory Champ', 
                        triviaQueen: 'üíñ Soulmate',
                        secretUnlocked: 'üîì Secret Keeper'
                    };
                    return badgeNames[key];
                });
            
            if (unlockedBadges.length > 0) {
                document.getElementById('achievements').style.display = 'block';
                badgeList.innerHTML = unlockedBadges.map(name => 
                    `<div class="badge">${name}</div>`
                ).join('');
            }
        }

        function isBirthdayTime() {
            return new Date() >= BIRTHDAY_DATE;
        }
        
        function updateSectionLocks() {
            const sections = ['gallery', 'wishes', 'games'];
            const navBtns = {
                gallery: document.getElementById('galleryBtn'),
                wishes: document.getElementById('wishesBtn'),
                games: document.getElementById('gamesBtn')
            };
            
            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                const navBtn = navBtns[sectionId];
                
                if (!isBirthdayTime()) {
                    section.classList.add('locked');
                    if (!section.querySelector('.locked-overlay')) {
                        const overlay = document.createElement('div');
                        overlay.className = 'locked-overlay';
                        const daysLeft = Math.floor((BIRTHDAY_DATE - new Date()) / (1000*60*60*24));
                        overlay.innerHTML = `
                            <div class="lock-icon">üîí</div>
                            <div class="lock-message">
                                Locked until Birthday!<br>
                                <span style="font-size:0.7em;font-weight:400">
                                    ${daysLeft} days left ‚ú®
                                </span>
                            </div>
                        `;
                        section.insertBefore(overlay, section.firstChild);
                    }
                    navBtn.classList.add('locked');
                } else {
                    section.classList.remove('locked');
                    const overlay = section.querySelector('.locked-overlay');
                    if (overlay) overlay.remove();
                    navBtn.classList.remove('locked');
                }
            });
        }

        // ENHANCED SMOOTH SCROLL NAVIGATION
        function showSection(sectionId, event) {
            if (!isBirthdayTime() && sectionId !== 'home') {
                triggerConfetti();
                alert('üéâ Locked until Birthday! Come back on Jan 27th! üíñ');
                return;
            }
            
            document.querySelectorAll('section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(button => button.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
            
            document.getElementById(sectionId).scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
            
            if (sectionId === 'home') triggerConfetti();
            if (sectionId === 'games') setTimeout(() => {
                initGames(); 
                checkAchievements();
            }, 300);
        }
        
        function createGallery() {
            const publicGallery = document.getElementById('public-gallery');
            for(let i = 1; i <= 28; i++) {
                const img = document.createElement('img');
                img.src = `images/memory${i}.jpg`;
                img.alt = `Memory ${i}`;
                img.loading = 'lazy';
                img.onclick = (e) => openModal(e.target);
                img.onerror = () => img.classList.add('error');
                publicGallery.appendChild(img);
            }
        }
        
        function preloadImages() {
            for(let i = 1; i <= 40; i++) {
                const img = new Image();
                img.src = `images/memory${i}.jpg`;
            }
        }
        
        function updateCountdown() {
            const now = new Date();
            const diff = BIRTHDAY_DATE - now;
            const countdownEl = document.getElementById('countdown');
            if (diff > 0) {
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                countdownEl.innerHTML = `<div><span>${days}</span>Days</div><div><span>${hours}</span>Hours</div><div><span>${minutes}</span>Mins</div><div><span>${seconds}</span>Secs</div>`;
            } else {
                countdownEl.innerHTML = '<div style="font-size:clamp(2.5rem,10vw,4rem);color:#ffd700;padding:50px;font-weight:900">üéâ IT\'S BIRTHDAY TIME! üéâ</div>';
            }
        }
        
        function triggerConfetti() {
            confetti({particleCount: 150, spread: 70, origin: { y: 0.6 }});
            setTimeout(() => confetti({particleCount: 120, angle: 60, spread: 55, origin: { x: 0 }}), 250);
            setTimeout(() => confetti({particleCount: 120, angle: 120, spread: 55, origin: { x: 1 }}), 500);
        }
        
        function shareBirthday() {
            const shareData = {
                title: 'Happy Birthday Shree! üéâ',
                text: 'Check out this amazing birthday surprise! üíñ',
                url: window.location.href
            };
            
            if (/Android|iPhone/i.test(navigator.userAgent)) {
                window.open(`https://wa.me/?text=${encodeURIComponent(shareData.text + '\n' + shareData.url)}`, '_blank');
            } else if (navigator.share) {
                navigator.share(shareData);
            } else {
                navigator.clipboard.writeText(shareData.url).then(() => {
                    alert('üéâ Birthday link copied! üìã Share on WhatsApp/Facebook! üíï');
                }).catch(() => {
                    prompt('Copy this link:', shareData.url);
                });
            }
            triggerConfetti();
        }
        
        function unlockSecret() {
            const input = document.getElementById('secret-code');
            if (input.value === SECRET_CODE) {
                document.getElementById('secret-gallery').style.display = 'block';
                document.getElementById('secret-input').style.display = 'none';
                triggerConfetti();
                checkAchievements();
                setTimeout(() => document.getElementById('secret-gallery').scrollIntoView({behavior: 'smooth'}), 500);
            } else {
                input.value = '';
                input.focus();
                input.style.borderColor = '#ff6b6b';
                setTimeout(() => input.style.borderColor = 'rgba(255,255,255,.4)', 1000);
                alert('‚ùå Wrong code! Contact Pikai. üíï');
            }
        }
        
        function openModal(img) {
            const modal = document.createElement('div');
            modal.className = 'md';
            modal.innerHTML = `<img src="${img.src}" alt="${img.alt}">`;
            modal.onclick = () => modal.remove();
            document.body.appendChild(modal);
            triggerConfetti();
        }
        
        // Memory Game (unchanged)
        function initMemoryGame() {
            memoryCanvas = document.getElementById('memoryGame');
            memoryCtx = memoryCanvas.getContext('2d');
            memoryCanvas.width = 400;
            memoryCanvas.height = 300;
            
            const cards = ['üéÇ','üéÅ','üéà','üéâ','üíñ','‚ú®','üåü','üç∞'];
            memoryGameCards = [...cards, ...cards].sort(() => Math.random() - 0.5);
            memoryBoard = memoryGameCards.map(() => ({flipped: false, matched: false}));
            memoryFlipped = [];
            memoryScore = 0;
            
            function drawCard(x, y, width, height, emoji, flipped, matched) {
                memoryCtx.save();
                memoryCtx.fillStyle = matched ? '#ffd700' : (flipped ? '#fff' : '#ff6b6b');
                memoryCtx.fillRect(x, y, width, height);
                
                memoryCtx.lineWidth = 3;
                memoryCtx.strokeStyle = '#fff';
                memoryCtx.strokeRect(x, y, width, height);
                
                if (flipped || matched) {
                    memoryCtx.font = 'bold 36px Arial';
                    memoryCtx.fillStyle = '#ff6b6b';
                    memoryCtx.textAlign = 'center';
                    memoryCtx.textBaseline = 'middle';
                    memoryCtx.fillText(emoji, x + width/2, y + height/2);
                }
                memoryCtx.restore();
            }
            
            function drawBoard() {
                memoryCtx.clearRect(0, 0, 400, 300);
                for(let i = 0; i < 16; i++) {
                    const x = (i % 4) * 98 + 6;
                    const y = Math.floor(i / 4) * 73 + 6;
                    drawCard(x, y, 92, 67, memoryGameCards[i], memoryBoard[i].flipped, memoryBoard[i].matched);
                }
            }
            
            memoryCanvas.onclick = (e) => {
                const rect = memoryCanvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const col = Math.floor(x / 100);
                const row = Math.floor(y / 75);
                const idx = row * 4 + col;
                
                if (idx >= 0 && idx < 16 && !memoryBoard[idx].flipped && !memoryBoard[idx].matched && memoryFlipped.length < 2) {
                    memoryBoard[idx].flipped = true;
                    memoryFlipped.push(idx);
                    drawBoard();
                    
                    if (memoryFlipped.length === 2) {
                        setTimeout(() => {
                            const idx1 = memoryFlipped[0];
                            const idx2 = memoryFlipped[1];
                            if (memoryGameCards[idx1] === memoryGameCards[idx2]) {
                                memoryBoard[idx1].matched = true;
                                memoryBoard[idx2].matched = true;
                                memoryScore += 10;
                                document.getElementById('memoryScore').textContent = `Score: ${memoryScore}`;
                                checkAchievements();
                                if (memoryScore >= 80) triggerConfetti();
                            } else {
                                memoryBoard[idx1].flipped = false;
                                memoryBoard[idx2].flipped = false;
                            }
                            memoryFlipped = [];
                            drawBoard();
                        }, 1200);
                    }
                }
            };
            drawBoard();
            document.getElementById('memoryScore').textContent = `Score: ${memoryScore}`;
        }
        
        // Quiz Game (unchanged)
        const quizQuestions = [
            {q: "Do you love me?", o1: "Yes üíï", o2: "No", a: 0},
            {q: "What's your favorite ice cream flavor?", o1: "Chocolate", o2: "Vanilla", a: 1},
            {q: "Best birthday gift ever?", o1: "Your love", o2: "iPhone", a: 0},
            {q: "Shree's dream destination?", o1: "Paris", o2: "Maldives", a: 0},
            {q: "Puchur birth time?", o1: "Morning", o2: "Night", a: 1},
            {q: "Favorite color?", o1: "Pink üíñ", o2: "Blue", a: 0},
            {q: "Our first date location?", o1: "Cafe", o2: "Park", a: 1},
            {q: "Shree's favorite food?", o1: "Pizza", o2: "Pasta", a: 0}
        ];
        
        function initQuiz() {
            quizCurrent = 0;
            quizScore = 0;
            document.getElementById('quizScore').textContent = 'Score: 0/8';
            
            const quizGame = document.getElementById('quizGame');
            quizGame.innerHTML = `
                <p id="quizQuestion" style="color:#fff;font-size:clamp(1.3rem,4vw,1.5rem);margin-bottom:25px;">${quizQuestions[0].q}</p>
                <button id="quizBtn1" class="cb small" style="margin:8px;">${quizQuestions[0].o1}</button>
                <button id="quizBtn2" class="cb small" style="margin:8px;">${quizQuestions[0].o2}</button>
            `;
            
            document.getElementById('quizBtn1').onclick = () => quizAnswer(0);
            document.getElementById('quizBtn2').onclick = () => quizAnswer(1);
        }
        
        function quizAnswer(selected) {
            if(selected === quizQuestions[quizCurrent].a) {
                quizScore++;
                triggerConfetti();
            }
            quizCurrent++;
            document.getElementById('quizScore').textContent = `Score: ${quizScore}/${quizCurrent}`;
            checkAchievements();
            
            if(quizCurrent < 8) {
                const quizGame = document.getElementById('quizGame');
                quizGame.innerHTML = `
                    <p id="quizQuestion" style="color:#fff;font-size:clamp(1.3rem,4vw,1.5rem);margin-bottom:25px;">${quizQuestions[quizCurrent].q}</p>
                    <button id="quizBtn1" class="cb small" style="margin:8px;">${quizQuestions[quizCurrent].o1}</button>
                    <button id="quizBtn2" class="cb small" style="margin:8px;">${quizQuestions[quizCurrent].o2}</button>
                `;
                document.getElementById('quizBtn1').onclick = () => quizAnswer(0);
                document.getElementById('quizBtn2').onclick = () => quizAnswer(1);
            } else {
                const message = quizScore >= 7 ? 'üíñ Perfect! You know me so well! üíï' : 
                               quizScore >= 5 ? 'üåü Great job! üéâ' : 'üíï Sweet effort! Try again!';
                document.getElementById('quizGame').innerHTML = `
                    <h3 style="color:var(--g);font-size:clamp(1.5rem,5vw,2rem);">${message}</h3>
                    <p style="color:#fff;font-size:1.3rem;margin:20px 0;">Final Score: ${quizScore}/8 ‚≠ê</p>
                    <button class="cb small" onclick="initQuiz()" style="margin-top:20px;">Play Again üíñ</button>
                `;
            }
        }
        
        function resetGames() {
            memoryScore = 0;
            quizCurrent = 0;
            quizScore = 0;
            memoryFlipped = [];
            
            document.getElementById('memoryScore').textContent = 'Score: 0';
            document.getElementById('quizScore').textContent = 'Score: 0/8';
            
            initMemoryGame();
            initQuiz();
            triggerConfetti();
            checkAchievements();
        }
        
        function initGames() {
            initMemoryGame();
            initQuiz();
        }
        
        function createHeart() {
            const heart = document.createElement('div');
            heart.innerHTML = 'üíñ';
            heart.className = 'heart';
            heart.style.left = Math.random() * 100 + '%';
            heart.style.animationDuration = (5 + Math.random() * 3) + 's';
            heart.style.fontSize = (15 + Math.random() * 15) + 'px';
            document.getElementById('hearts').appendChild(heart);
            setTimeout(() => heart.remove(), 9000);
        }
        
        function createSparkle() {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.style.left = Math.random() * 100 + '%';
            sparkle.style.animationDuration = (2 + Math.random() * 2) + 's';
            document.getElementById('sparkles').appendChild(sparkle);
            setTimeout(() => sparkle.remove(), 4000);
        }
        
        // Initialize everything
        window.addEventListener('load', function() {
            preloadImages();
            createGallery();
            updateCountdown();
            setInterval(updateCountdown, 1000);
            setInterval(createHeart, 300);
            setInterval(createSparkle, 500);
            setInterval(checkAchievements, 5000);
            
            updateSectionLocks();
            setInterval(updateSectionLocks, 60000);
            
            document.querySelectorAll('nav button').forEach(btn => {
                btn.onclick = (e) => showSection(btn.dataset.section, e);
            });
            
            document.getElementById('resetBtn').onclick = resetGames;
            document.getElementById('secret-code').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') unlockSecret();
            });

            if (isBirthdayTime()) {
                setTimeout(() => musicToggle.click(), 1500);
            }
        });
    </script>
</body>
</html>
